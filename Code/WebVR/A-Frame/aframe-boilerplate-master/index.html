<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Hello, World! - A-Frame</title>
    <meta name="description" content="Hello, World! - A-Frame">
    <script src="https://aframe.io/releases/0.5.0/aframe.min.js"></script>

    <style type="text/css">
    	p{
    		color: red;
    	}

    	body{
    		background-color: white;
    	}

    	.float{
    		float: right;
    	}

    	.bluediv{
    		width: 300px;
    		margin: auto;
    		background-color: blue;
    	}
    </style>

  </head>
  <body>
    <h1>Title 1</h1>
    <h3>Title 3</h3>
    <p>Text</p>

    <div class="bluediv">
    	<h2>A DIV</h2>
    	<p>A p in a div</p>
    </div>

    <img src="owl.jpg">
    <h2 class="float">Float</h2>
    
    <script type="text/javascript">
    var camera;

    window.onload = function(){
    	items = new Array(document.body);
    	var doc_items = document.body.getElementsByTagName("*");

    	for(var i = 0; i < doc_items.length; i++)
    		items.push(doc_items[i]);


    	var a_scene = document.createElement("a-scene");

        //Sky
        var a_sky = document.createElement("a-sky");
        a_sky.setAttribute("color", "#DDDDDD");
        a_scene.appendChild(a_sky);

        //Assets
        var a_assets = document.createElement("a-assets");
        a_scene.appendChild(a_assets);

        var img_id = 0;
        var z_index = -40;

        var body_width;

		var standard_p = document.createElement("p");
        document.body.appendChild(standard_p);
        var pixels_in_one_unit = parseFloat(window.getComputedStyle(standard_p).getPropertyValue("font-size"));
        var pixel_text_size = 1/pixels_in_one_unit;
        document.body.removeChild(standard_p);

		for (i = 0; i < items.length; i++) {

			element = items[i];
			console.log(element);
			element_style = window.getComputedStyle(element);
			position = element.getBoundingClientRect();

			if(element.tagName == "BODY" || element.tagName == "DIV" ){
				var pane = document.createElement("a-plane");

				width = (position.right - position.left)/pixels_in_one_unit;
				height = (position.bottom - position.top)/pixels_in_one_unit;

				if(element.tagName == "BODY")
					body_width = width;

				pane.setAttribute("width", width);
				pane.setAttribute("height", height);
				pane.setAttribute('color', element_style.getPropertyValue("background-color"));

				y_relative = position.top;

				//TODO div staat fout
				if(element.childNodes.length > 0)
					y_relative = element.children[0].getBoundingClientRect().top;

				y = y_relative/pixels_in_one_unit - height/2;

				pane.setAttribute('position', {x: position.left/pixels_in_one_unit + width/2, y: y, z: z_index - 0.1})

				a_scene.appendChild(pane);
			}	

        	//Text based elements
		    if(element.tagName == "P" || element.tagName.startsWith("H")){
		    	var par = document.createElement("a-text");


		    	par.setAttribute('color', element_style.getPropertyValue("color"));
	            par.setAttribute("text","value: " + element.innerHTML + ";");

	            var scale = pixel_text_size * parseFloat(element_style.getPropertyValue("font-size"));

	            par.setAttribute("width",scale * 20);
	            //par.setAttribute("font","Times New Toman")//element_style.getPropertyValue("font"));
	            par.setAttribute("position",{x: position.left/pixels_in_one_unit, y: -position.top/pixels_in_one_unit, z: z_index});
	    		a_scene.appendChild(par);
		    }

            //Images
            if(element.tagName == "IMG"){
              var asset = element.cloneNode(true);
              var asset_id = "img-asset-" + img_id++;

              asset.setAttribute("id",asset_id);
              a_assets.appendChild(asset);

              var img = document.createElement("a-image");
              img.setAttribute("src","#"+asset_id);

              img_width = element.clientWidth / pixels_in_one_unit;
              img_height = element.clientHeight / pixels_in_one_unit;
              img.setAttribute("width",img_width);
              img.setAttribute("height",img_height);

              img.setAttribute('position', {x: position.left/pixels_in_one_unit + img_width/2, y: -position.top/pixels_in_one_unit - img_height/2, z: z_index})

              a_scene.appendChild(img);
            }

            //element.style.display="none";
		}

		//Camera
		camera = document.createElement("a-entity");
		camera.appendChild(document.createElement("a-camera"));
		camera.setAttribute("position", body_width/2 + " 0 0");

		a_scene.appendChild(camera);

    	document.body.appendChild(a_scene);
    };

    document.onkeydown = checkKey;

	function checkKey(e) {

	    e = e || window.event;

	    if (e.keyCode == '65') {
	    	var pos = camera.getAttribute("position");
	        camera.setAttribute("position", pos.x+ " "+ (pos.y + 2) +" "+ pos.z);
	    }
	    else if (e.keyCode == '69') {
	        var pos = camera.getAttribute("position");
	        camera.setAttribute("position", pos.x+ " "+ (pos.y - 2) +" "+ pos.z);
	    }

	}

    /*setTimeout(function(){
    	elements = document.getElementsByTagName("a-text");
    	for(i = 0; i < elements.length; i++){
    		element = elements[i];

    		pos = element.getAttribute("position");
    		x = pos.x + 0;
    		y = pos.y + 3;
    		z = pos.z + 0;
    		element.setAttribute("position", x+" "+y+" "+z);
    	}
    },3000);*/

    </script>
  </body>

</html>
